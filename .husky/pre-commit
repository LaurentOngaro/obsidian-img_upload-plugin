#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Prefer running pre-commit framework if installed so `pre-commit run --all-files` works
if command -v pre-commit >/dev/null 2>&1; then
  echo "Running pre-commit hooks via pre-commit (all-files)..."
  pre-commit run --hook-stage commit --all-files
  status=$?
  if [ $status -ne 0 ]; then
    echo "Pre-commit (pre-commit) failed — aborting commit."
    exit $status
  fi
  echo "Pre-commit checks (pre-commit) passed."
  exit 0
fi

# Fallback: run CI checks directly
echo "pre-commit not found — running local CI checks: tests + build"

npm run ci:checks
if [ $? -ne 0 ]; then
  echo "Pre-commit: CI checks failed — aborting commit."
  exit 1
fi

echo "Pre-commit checks passed."
